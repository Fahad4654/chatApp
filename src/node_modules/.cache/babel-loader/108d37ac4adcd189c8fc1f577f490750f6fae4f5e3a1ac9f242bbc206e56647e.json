{"ast":null,"code":"// src/components/ChatRoom.js\nimport React,{useState,useEffect}from'react';import{firestore}from'../firebase';import{collection,addDoc,serverTimestamp,query,orderBy,onSnapshot}from'firebase/firestore';import SearchUser from'./SearchUser';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChatRoom=_ref=>{let{user}=_ref;const[chats,setChats]=useState([]);const[newMessage,setNewMessage]=useState('');const[selectedUser,setSelectedUser]=useState(null);// State to track selected user\nuseEffect(()=>{const chatsCollection=collection(firestore,'chats');const q=query(chatsCollection,orderBy('timestamp'));const unsubscribe=onSnapshot(q,snapshot=>{setChats(snapshot.docs.map(doc=>({id:doc.id,...doc.data()})));});return unsubscribe;},[]);const sendMessage=async e=>{e.preventDefault();if(newMessage.trim()===''||!selectedUser)return;// Check if a user is selected\nawait addDoc(collection(firestore,'chats'),{text:newMessage,senderId:user.uid,senderName:user.displayName,receiverId:selectedUser.uid,receiverName:selectedUser.displayName,timestamp:serverTimestamp()});setNewMessage('');};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[/*#__PURE__*/_jsx(SearchUser,{onSelectUser:setSelectedUser}),\" \",selectedUser&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Chatting with \",selectedUser.displayName]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-window\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-header\",children:\"Chat Room\"}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-messages\",children:chats.filter(chat=>chat.senderId===user.uid&&chat.receiverId===(selectedUser===null||selectedUser===void 0?void 0:selectedUser.uid)||chat.senderId===(selectedUser===null||selectedUser===void 0?void 0:selectedUser.uid)&&chat.receiverId===user.uid)// Filter messages between current user and selected user\n.map(chat=>/*#__PURE__*/_jsxs(\"div\",{className:`message ${chat.senderId===user.uid?'sent':'received'}`,children:[/*#__PURE__*/_jsx(\"strong\",{children:chat.senderName}),\": \",chat.text]},chat.id))}),/*#__PURE__*/_jsxs(\"form\",{className:\"chat-input\",onSubmit:sendMessage,children:[/*#__PURE__*/_jsx(\"input\",{value:newMessage,onChange:e=>setNewMessage(e.target.value),placeholder:\"Type a message...\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Send\"})]})]})]});};export default ChatRoom;","map":{"version":3,"names":["React","useState","useEffect","firestore","collection","addDoc","serverTimestamp","query","orderBy","onSnapshot","SearchUser","jsx","_jsx","jsxs","_jsxs","ChatRoom","_ref","user","chats","setChats","newMessage","setNewMessage","selectedUser","setSelectedUser","chatsCollection","q","unsubscribe","snapshot","docs","map","doc","id","data","sendMessage","e","preventDefault","trim","text","senderId","uid","senderName","displayName","receiverId","receiverName","timestamp","className","children","onSelectUser","filter","chat","onSubmit","value","onChange","target","placeholder","type"],"sources":["/home/fahad/Music/my_project/chat/react-firebase-chat/src/components/ChatRoom.js"],"sourcesContent":["// src/components/ChatRoom.js\nimport React, { useState, useEffect } from 'react';\nimport { firestore } from '../firebase';\nimport { collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from 'firebase/firestore';\nimport SearchUser from './SearchUser';\n\nconst ChatRoom = ({ user }) => {\n  const [chats, setChats] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [selectedUser, setSelectedUser] = useState(null); // State to track selected user\n\n  useEffect(() => {\n    const chatsCollection = collection(firestore, 'chats');\n    const q = query(chatsCollection, orderBy('timestamp'));\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      setChats(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\n    });\n\n    return unsubscribe;\n  }, []);\n\n  const sendMessage = async (e) => {\n    e.preventDefault();\n    if (newMessage.trim() === '' || !selectedUser) return; // Check if a user is selected\n\n    await addDoc(collection(firestore, 'chats'), {\n      text: newMessage,\n      senderId: user.uid,\n      senderName: user.displayName,\n      receiverId: selectedUser.uid,\n      receiverName: selectedUser.displayName,\n      timestamp: serverTimestamp(),\n    });\n\n    setNewMessage('');\n  };\n\n  return (\n    <div className=\"chat-container\">\n      <SearchUser onSelectUser={setSelectedUser} /> {/* Pass the setSelectedUser to handle user selection */}\n      {selectedUser && <div>Chatting with {selectedUser.displayName}</div>}\n      <div className=\"chat-window\">\n        <div className=\"chat-header\">Chat Room</div>\n        <div className=\"chat-messages\">\n          {chats\n            .filter(chat => (chat.senderId === user.uid && chat.receiverId === selectedUser?.uid) || \n                            (chat.senderId === selectedUser?.uid && chat.receiverId === user.uid)) // Filter messages between current user and selected user\n            .map(chat => (\n              <div\n                key={chat.id}\n                className={`message ${chat.senderId === user.uid ? 'sent' : 'received'}`}\n              >\n                <strong>{chat.senderName}</strong>: {chat.text}\n              </div>\n          ))}\n        </div>\n        <form className=\"chat-input\" onSubmit={sendMessage}>\n          <input\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            placeholder=\"Type a message...\"\n          />\n          <button type=\"submit\">Send</button>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatRoom;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}